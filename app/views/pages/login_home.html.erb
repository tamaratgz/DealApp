
<div class="hello-edit">
  <h1 class="titlepoll">HELLO!</h1>

  <%# Edit button coming soon: First need profile page %>
  <%= link_to "Edit", edit_user_registration_path %>
</div>

<div class="profileblock">

  <%# Total polls created %>
  <div class="polls">
    <% polls_count = 0 %>
    <% current_user.projects.each do |project| %>
      <% polls_count += project.polls.count %>
    <% end %>
    <% polls_count += current_user.polls.count %>

    <p style="font-size: 35px; color:white"><%= polls_count %></p>
    <p style="color:white; margin-top: -40%">polls</p>
  </div>

  <div>
    <%# <% current_user %>
    <%# <% current_user.avatar %>
    <%# Works for new created accounts. Seed does not work. %>
    <% if current_user.avatar.attached? %>
      <%= image_tag current_user.avatar, style: "width: 80px; border-radius: 50%", class: "avatar-profile" %>
    <% else %>

    <% end %>
    <%# Total answers created %>
    <div class="answers">
      <% answer_count = 0 %>
      <% current_user.projects.each do |project| %>
        <% project.polls.each do |poll| %>
          <% answer_count += poll.answers.count %>
        <% end %>
      <% end %>
      <% current_user.polls.each do |poll| %>
        <% answer_count += poll.answers.count %>
      <% end %>

      <div class="answers-position">
        <p style="font-size: 35px; color:white"><%= answer_count %></p>
        <p style="color:white; margin-top: -20%">answers</p>
      </div>
    </div>
  </div>

  <%# Total projects created %>
  <div class="projects">
    <p style="font-size: 35px; color:white"><%= current_user.projects.count %></p>
    <p style="color:white; margin-top: -20%">projects</p>
  </div>

</div>





<h3 class="titlepoll">My polls</h3>
<%= link_to 'See all', polls_path %>
<ul>
  <% current_user.polls.first(6).each do |poll| %>
    <li style="background-color: green; margin: 10px;">
      <%= link_to polls_path do %>
        <p><strong><%= poll.title %></strong></p>
      <% end %>
      <%= link_to polls_path do %>
        <p><%= poll.description %></p>
      <% end %>
      <ul>
        <% poll.answers.sort_by(&:votes_count).reverse.each do |answer| %>
            <li><%= answer.title %> -
            <% if answer.votes.count == 1 %>
              <%= answer.votes.count %> vote
            <% else %>
              <%= answer.votes.count %> votes
            <% end %>
        <% end %>
      </ul>

      <div class="deadline-and-icons">
        <div>
        <% if (poll.deadline.to_date - Date.current).to_i == 1 %>
          <p><%= (poll.deadline.to_date - Date.current).to_i %>day left</p>
        <% elsif (poll.deadline.to_date - Date.current).to_i > 1 %>
          <p><%= (poll.deadline.to_date - Date.current).to_i %> days left</p>
        <% elsif (poll.deadline.to_date - Date.current).to_i == 0 %>
          <p>This poll ends today</p>
        <% else %>
          <p>This poll has ended</p>
        <% end %>
          <%# Share button to be coded %>
          <i class="fa-solid fa-share-nodes"></i>
          <%# End of share button to be coded %>
          <%= link_to poll_path(poll), method: :delete do %>
            <i class="fa-solid fa-trash"></i>
          <% end %>
          <%= link_to edit_poll_path(poll) do %>
            <i class="fa-solid fa-pencil"></i>
          <% end %>
      </div>
    </li>
  <% end %>
</ul>
<%= link_to 'Create a new poll', new_poll_path %>



<h3>My projects</h3>
<ul>
  <% current_user.projects.each do |project| %>
    <li style="background-color: purple; margin: 10px;">
      <%= link_to project_path(project) do %>
        <h3><%= project.title %></h3>
        <% if project.polls.count == 1 %>
          <p><%= project.polls.count %> poll</p>
        <% else %>
          <p><%= project.polls.count %> polls</p>
        <% end %>
      <% end %>
      <div class="deadline-and-icons">
        <div>
          <%# Share button to be coded %>
          <i class="fa-solid fa-share-nodes"></i>
          <%# End of share button to be coded %>
          <%= link_to project_path(project), method: :delete do %>
            <i class="fa-solid fa-trash"></i>
          <% end %>
          <%= link_to edit_project_path(project) do %>
            <i class="fa-solid fa-pencil"></i>
          <% end %>
      </div>
    </li>
  <% end %>
</ul>
<p style="padding-bottom: 100px;">
  <%= link_to "Create a new project", new_project_path %>
</p>
