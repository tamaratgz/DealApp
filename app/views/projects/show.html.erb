<%# Back button %>
<div style="margin: 30px;">
  <%= link_to root_path, class: "back" do %>
  <i class="fas fa-undo iconsnavbar"></i>
  <% end %>
</div>

<div class="title-with-avatar">
  <h1 class="titlepoll"><%= @project.title.upcase %></h1>
  <%# user-avatar goes here %>
  <% if current_user.avatar.attached? %>
    <%= image_tag current_user.avatar, style: "width: 55px; border-radius: 50%; margin-right: 20px;", class: "avatar-profile" %>
  <% else %>
    <%= image_tag "avatar.png", style: "width: 55px; border-radius: 50%; margin-right: 20px;", class: "avatar-profile" %>
  <% end %>
</div>


<div class="project-description-options">
  <p><%= @project.description %></p>

  <div>
    <%# Share button to be coded %>
    <i class="fas fa-share-alt fasicont"></i>

    <%= link_to project_path(@project), method: :delete do %>
      <i class="fas fa-trash fasicont"></i>
    <% end %>

    <%= link_to edit_project_path do %>
      <i class="fas fa-pencil-alt fasicont"></i>
    <% end %>
  </div>
</div>

<ul>
  <% @project.polls.each do |poll| %>
    <div class="container-poll">
      <li>
        <div>
          <div class="container-poll-title">
            <h3><%= poll.title %></h3>
          </div>
          <p style="font-size: 12px"><%= poll.description %></p>
          <ul>
            <% poll.answers.each do |answer| %>
              <div class="poll-answer-votes">
                <li class="poll-answers">
                  <%= answer.title %>
                </li>
                <span class="poll-votes">
                  <%= link_to answer.votes.count, answer_votes_path(answer.id), method: :post %>
                </span>
              </div>
            <% end %>
          </ul>

          <div class="deadline-and-icons">
            <%# HAS ENDED %>
            <% if (poll.deadline.to_datetime - DateTime.now).negative? %>
              <p>This poll has ended</p>
            <%# ENDS SAME DAY %>
            <% elsif (poll.deadline.day == DateTime.now.day) %>
            <%# MORE THAN ONE HOUR %>
              <% if (((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) > 1 %>
                <p>Poll ends in <%= ((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2 %> hours and <%= ( (((poll.deadline.to_datetime - DateTime.now) * 1440).to_i - 120) - ((((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) * 60)) %> minutes</p>
              <%# LESS THAN ONE HOUR %>
              <% else %>
                <p>Poll ends in <%= ((poll.deadline.to_datetime - DateTime.now) * 1440).to_i - 120 %> minutes</p>
              <% end %>
            <%# TOMORROW %>
            <% elsif (poll.deadline.day) == (DateTime.now.day + 1) %>
              <p>Poll ends in one day,
              <%= ( (((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) - ((poll.deadline.to_datetime - DateTime.now).to_i * 24) )%> hours and
              <%= ( ((((poll.deadline.to_datetime - DateTime.now) * 1440).to_i)) - ((((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) * 60) - 120)%> minutes</p>
            <%# FUTURE %>
            <% else %>
              <p>Poll ends in <%= (poll.deadline.to_datetime - DateTime.now).to_i %> days,
              <%= ( (((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) - ((poll.deadline.to_datetime - DateTime.now).to_i * 24) )%> hours and
              <%= ( ((((poll.deadline.to_datetime - DateTime.now) * 1440).to_i)) - ((((poll.deadline.to_datetime - DateTime.now) * 24).to_i - 2) * 60) - 120)%> minutes</p>
            <% end %>
            <div>
              <%# Share button to be coded %>
              <i class="fas fa-share-alt fasicont"></i>
              <%# End of share button to be coded %>
              <%= link_to poll_path(poll), method: :delete do %>
                <i class="fas fa-trash fasicont"></i>
              <% end %>
              <%= link_to edit_poll_path(poll) do %>
                <i class="fas fa-pencil-alt fasicont"></i>
              <% end %>
            </div>
          </div>

      </li>
    </div>
  <% end %>
</ul>

<div class="container-button">
  <span class="btn-main">
    <%= link_to "Create poll", new_poll_path %>
  </span>
</div>
